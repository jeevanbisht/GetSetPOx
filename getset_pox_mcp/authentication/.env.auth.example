# EntraID (Azure AD) Authentication Configuration
# Copy this file to .env and fill in your values

# ============================================
# REQUIRED CONFIGURATION
# ============================================

# Azure AD Tenant ID
# Find this in Azure Portal -> Azure Active Directory -> Properties -> Tenant ID
ENTRA_TENANT_ID=your-tenant-id-here

# Application (Client) ID
# Find this in Azure Portal -> App Registrations -> Your App -> Application ID
ENTRA_CLIENT_ID=your-client-id-here

# Application Client Secret (Required for application mode)
# Generate in Azure Portal -> App Registrations -> Your App -> Certificates & secrets
ENTRA_CLIENT_SECRET=your-client-secret-here

# ============================================
# OPTIONAL CONFIGURATION
# ============================================

# Enable/Disable Authentication (true/false)
# Set to 'true' to enable authentication, 'false' to disable
ENTRA_ENABLE_AUTH=false

# Authentication Mode ('application' or 'delegated')
# - application: Service/daemon authentication (client credentials flow)
# - delegated: User authentication (device code flow)
ENTRA_AUTH_MODE=application

# Authority URL (Optional - defaults to Azure public cloud)
# Format: https://login.microsoftonline.com/{tenant_id}
# For different clouds:
#   - Azure China: https://login.chinacloudapi.cn/{tenant_id}
#   - Azure Germany: https://login.microsoftonline.de/{tenant_id}
#   - Azure US Government: https://login.microsoftonline.us/{tenant_id}
# ENTRA_AUTHORITY=https://login.microsoftonline.com/your-tenant-id

# Permission Scopes (Comma-separated)
# For application mode, use: https://graph.microsoft.com/.default
# For delegated mode, specify individual scopes:
#   User.Read,Group.Read.All,Directory.Read.All
ENTRA_SCOPES=https://graph.microsoft.com/.default

# Redirect URI (For delegated mode only)
# Must match a redirect URI configured in your app registration
ENTRA_REDIRECT_URI=http://localhost:8000/callback

# Token Cache Path (Optional)
# Path to store cached tokens for reuse across sessions
# Leave empty to disable token caching
# ENTRA_TOKEN_CACHE_PATH=./.token_cache

# ============================================
# SECURITY NOTES
# ============================================

# 1. NEVER commit this file with real secrets to version control
# 2. Use a .gitignore entry for .env files
# 3. In production, use:
#    - Azure Key Vault for secrets
#    - Managed Identity when running in Azure
#    - Environment variables set by your hosting platform
# 4. Rotate client secrets regularly (every 6-12 months)
# 5. Use least privilege principle - only request needed permissions
# 6. Monitor authentication logs for suspicious activity

# ============================================
# QUICK START GUIDE
# ============================================

# 1. Create an App Registration in Azure Portal
#    - Go to Azure Active Directory -> App Registrations
#    - Click "+ New registration"
#    - Enter a name and configure settings
#    - Note the Application (client) ID and Tenant ID

# 2. Generate a Client Secret
#    - In your app registration, go to Certificates & secrets
#    - Click "+ New client secret"
#    - Add description and expiry period
#    - Copy the secret value (you can't see it again!)

# 3. Configure API Permissions
#    - In your app registration, go to API permissions
#    - Add permissions for Microsoft Graph
#    - Grant admin consent if required

# 4. Update this file with your values
#    - Copy to .env
#    - Fill in ENTRA_TENANT_ID, ENTRA_CLIENT_ID, ENTRA_CLIENT_SECRET
#    - Set ENTRA_ENABLE_AUTH=true

# 5. Test authentication
#    - Run your MCP server
#    - Check logs for successful authentication

# ============================================
# COMMON PERMISSION SCOPES
# ============================================

# Microsoft Graph API Scopes:
# - User.Read: Read user profile
# - User.ReadWrite.All: Read and write all users
# - Group.Read.All: Read all groups
# - Group.ReadWrite.All: Read and write all groups
# - Directory.Read.All: Read directory data
# - Directory.ReadWrite.All: Read and write directory data
# - Application.Read.All: Read applications
# - Device.Read.All: Read devices
# - Policy.Read.All: Read policies
# - Policy.ReadWrite.ConditionalAccess: Read/write conditional access

# For application permissions, use:
# ENTRA_SCOPES=https://graph.microsoft.com/.default

# For delegated permissions, list specific scopes:
# ENTRA_SCOPES=User.Read,Group.Read.All,Directory.Read.All

# ============================================
# TROUBLESHOOTING
# ============================================

# Issue: "AADSTS7000215: Invalid client secret"
# Solution: Generate a new client secret and update ENTRA_CLIENT_SECRET

# Issue: "AADSTS65001: User or admin has not consented"
# Solution: Grant admin consent in Azure Portal -> API permissions

# Issue: "Token acquisition failed"
# Solution: 
#   - Verify tenant ID, client ID, and secret are correct
#   - Check that API permissions are configured
#   - Ensure admin consent is granted
#   - Check server logs for detailed error messages

# Issue: "Authentication is disabled"
# Solution: Set ENTRA_ENABLE_AUTH=true

# For more help, see: docs/authentication.md
